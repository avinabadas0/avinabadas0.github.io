<!DOCTYPE html>
<html lang="{{ or .Site.Language.LanguageCode .Site.Language.Lang }}">

<head>
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body);"></script>
    <!-- Mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const isLight = document.documentElement.classList.contains('light');
            mermaid.initialize({ startOnLoad: false, theme: isLight ? 'default' : 'dark' });
            // Convert Hugo's code blocks to mermaid divs
            document.querySelectorAll('code.language-mermaid').forEach(el => {
                const pre = el.parentElement;
                const div = document.createElement('div');
                div.className = 'mermaid';
                div.textContent = el.textContent;
                pre.replaceWith(div);
            });
            mermaid.init(undefined, ".mermaid");
        });
    </script>
    <script>
        // Inline script to prevent theme flash
        (function () {
            const theme = localStorage.getItem('user-theme') || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
            if (theme === 'light') document.documentElement.classList.add('light');
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} | {{ .Site.Title }}</title>
    {{ $style := resources.Get "css/main.css" }}
    <link rel="stylesheet" href="{{ $style.RelPermalink }}">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <!-- DevIcons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <nav class="nav-island">
        <div class="nav-island__content">
            <a href="/" class="nav-island__link">Home</a>
            <div class="nav-island__divider"></div>
            <a href="/about" class="nav-island__link">About me</a>
            <div class="nav-island__divider"></div>
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                <i id="theme-icon"></i>
            </button>
        </div>
    </nav>
    <div class="l-container">
        {{ block "main" . }}{{ end }}
    </div>

    <script>
        // Initialize Lucide
        lucide.createIcons();

        const themeToggle = document.getElementById('theme-toggle');
        const root = document.documentElement;

        function updateThemeUI() {
            const isLight = root.classList.contains('light');
            const themeIcon = document.getElementById('theme-icon');
            if (!themeIcon) return;

            // User requested: "moon icon when its light theme and sun icon when its dark theme"
            const iconName = isLight ? 'moon' : 'sun';

            themeIcon.setAttribute('data-lucide', iconName);
            lucide.createIcons();
        }

        // Initial UI update
        updateThemeUI();

        themeToggle.addEventListener('click', () => {
            const isLight = root.classList.toggle('light');
            localStorage.setItem('user-theme', isLight ? 'light' : 'dark');
            updateThemeUI();
        });
    </script>
</body>

</html>